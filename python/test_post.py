#!/usr/bin/python
import urllib
import urllib2
import sys
# Author: Bang Pham Huu, mailto: b.phamhuu@jacobs-university.de
# Send the query in POST request to stretching service
url = "http://localhost:8090/python"
petascopeEndPoint = 'http://mars.planetserver.eu:8080/rasdaman/ows?query='

wcpsQuery = 'for data in ( frt0000b385_07_if164l_trr3 ) return encode({ red: ( (float)((int)( 255 / ( max((1 - (data.band_178 / ((0.800164224902) * data.band_171 + (0.199835775098) * data.band_206)))) - min((1 - (data.band_178 / ((0.800164224902) * data.band_171 + (0.199835775098) * data.band_206)))) )) * ( ((1 - (data.band_178 / ((0.800164224902) * data.band_171 + (0.199835775098) * data.band_206)))) - min((1 - (data.band_178 / ((0.800164224902) * data.band_171 + (0.199835775098) * data.band_206)))) )) < (float)((int)( 255 / ( max((1 - (data.band_185 / ((0.600198798565) * data.band_171 + (0.399801201435) * data.band_206)))) - min((1 - (data.band_185 / ((0.600198798565) * data.band_171 + (0.399801201435) * data.band_206)))) )) * ( ((1 - (data.band_185 / ((0.600198798565) * data.band_171 + (0.399801201435) * data.band_206)))) - min((1 - (data.band_185 / ((0.600198798565) * data.band_171 + (0.399801201435) * data.band_206)))) )) ) * (float)((int)( 255 / ( max((1 - (data.band_178 / ((0.800164224902) * data.band_171 + (0.199835775098) * data.band_206)))) - min((1 - (data.band_178 / ((0.800164224902) * data.band_171 + (0.199835775098) * data.band_206)))) )) * ( ((1 - (data.band_178 / ((0.800164224902) * data.band_171 + (0.199835775098) * data.band_206)))) - min((1 - (data.band_178 / ((0.800164224902) * data.band_171 + (0.199835775098) * data.band_206)))) )) + ( (float)((int)( 255 / ( max((1 - (data.band_178 / ((0.800164224902) * data.band_171 + (0.199835775098) * data.band_206)))) - min((1 - (data.band_178 / ((0.800164224902) * data.band_171 + (0.199835775098) * data.band_206)))) )) * ( ((1 - (data.band_178 / ((0.800164224902) * data.band_171 + (0.199835775098) * data.band_206)))) - min((1 - (data.band_178 / ((0.800164224902) * data.band_171 + (0.199835775098) * data.band_206)))) )) > (float)((int)( 255 / ( max((1 - (data.band_185 / ((0.600198798565) * data.band_171 + (0.399801201435) * data.band_206)))) - min((1 - (data.band_185 / ((0.600198798565) * data.band_171 + (0.399801201435) * data.band_206)))) )) * ( ((1 - (data.band_185 / ((0.600198798565) * data.band_171 + (0.399801201435) * data.band_206)))) - min((1 - (data.band_185 / ((0.600198798565) * data.band_171 + (0.399801201435) * data.band_206)))) )) ) * (float)((int)( 255 / ( max((1 - (data.band_185 / ((0.600198798565) * data.band_171 + (0.399801201435) * data.band_206)))) - min((1 - (data.band_185 / ((0.600198798565) * data.band_171 + (0.399801201435) * data.band_206)))) )) * ( ((1 - (data.band_185 / ((0.600198798565) * data.band_171 + (0.399801201435) * data.band_206)))) - min((1 - (data.band_185 / ((0.600198798565) * data.band_171 + (0.399801201435) * data.band_206)))) ));green: (float)((int)( 255 / ( max((1-((data.band_197) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.29 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) + (data.band_201) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.32 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) + (data.band_203) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.33 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) / (data.band_171) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.12 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) + (data.band_179) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.17 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) + (data.band_185) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.21 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53))))) - min((1-((data.band_197) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.29 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) + (data.band_201) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.32 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) + (data.band_203) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.33 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) / (data.band_171) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.12 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) + (data.band_179) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.17 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) + (data.band_185) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.21 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53))))) )) * ( ((1-((data.band_197) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.29 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) + (data.band_201) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.32 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) + (data.band_203) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.33 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) / (data.band_171) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.12 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) + (data.band_179) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.17 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) + (data.band_185) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.21 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53))))) - min((1-((data.band_197) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.29 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) + (data.band_201) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.32 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) + (data.band_203) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.33 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) / (data.band_171) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.12 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) + (data.band_179) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.17 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53)) + (data.band_185) / (((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.21 + (data.band_233 - ((data.band_233 - data.band_125) / (2.53 - 1.815)) * 2.53))))) ));blue: (float)((int)( 255 / ( max(((((((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.12 + (data.band_233 - ((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.53)) - (data.band_171))/ (((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.12 + (data.band_233 - ((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.53))) * 0.1 + (((((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.14 + (data.band_233 - ((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.53)) - (data.band_174))/ (((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.14 + (data.band_233 - ((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.53))) * 0.1)) - min(((((((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.12 + (data.band_233 - ((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.53)) - (data.band_171))/ (((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.12 + (data.band_233 - ((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.53))) * 0.1 + (((((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.14 + (data.band_233 - ((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.53)) - (data.band_174))/ (((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.14 + (data.band_233 - ((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.53))) * 0.1)) )) * ( (((((((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.12 + (data.band_233 - ((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.53)) - (data.band_171))/ (((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.12 + (data.band_233 - ((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.53))) * 0.1 + (((((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.14 + (data.band_233 - ((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.53)) - (data.band_174))/ (((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.14 + (data.band_233 - ((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.53))) * 0.1)) - min(((((((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.12 + (data.band_233 - ((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.53)) - (data.band_171))/ (((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.12 + (data.band_233 - ((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.53))) * 0.1 + (((((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.14 + (data.band_233 - ((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.53)) - (data.band_174))/ (((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.14 + (data.band_233 - ((data.band_233 - data.band_106) / (2.53 - 1.69)) * 2.53))) * 0.1)) ));alpha: (float)((data.band_100 > 0) * 255)}, "tiff", "nodata=65535")'

# must enquote the query or it is not valid request
URI = petascopeEndPoint + urllib.quote(wcpsQuery)

data = urllib.urlencode({'wcpsQuery' : URI})
req = urllib2.Request(url, data)
print url
print data
response = urllib2.urlopen(req)
content = response.read()

f = open("test_post.png", "w")
f.write(content)
f.close()

