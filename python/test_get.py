#!/usr/bin/python
import urllib
import urllib2
import sys
# Author: Bang Pham Huu, mailto: b.phamhuu@jacobs-university.de
url = 'http://localhost:8090/python?wcpsQuery=http://mars.planetserver.eu:8080/rasdaman/ows?query='
wcpsQuery = 'for data in ( frt0000c202_07_if165l_trr3 ) return encode( {Red:(float)((int)( 255 / ( max(0.5 * (1 - (data.band_142 / ((0.636534839925) * data.band_130 + (0.363465160075) * data.band_163))) + 0.5 * (1 - (data.band_151 / ((0.363832621377) * data.band_130 + (0.636167378623) * data.band_163)))) - min(0.5 * (1 - (data.band_142 / ((0.636534839925) * data.band_130 + (0.363465160075) * data.band_163))) + 0.5 * (1 - (data.band_151 / ((0.363832621377) * data.band_130 + (0.636167378623) * data.band_163)))) )) * ( (0.5 * (1 - (data.band_142 / ((0.636534839925) * data.band_130 + (0.363465160075) * data.band_163))) + 0.5 * (1 - (data.band_151 / ((0.363832621377) * data.band_130 + (0.636167378623) * data.band_163)))) - min(0.5 * (1 - (data.band_142 / ((0.636534839925) * data.band_130 + (0.363465160075) * data.band_163))) + 0.5 * (1 - (data.band_151 / ((0.363832621377) * data.band_130 + (0.636167378623) * data.band_163)))) )); Green:(float)((int)( 255 / ( max((1 - ((data.band_178)/((1 - 0.199835775) * (data.band_171) + (0.199835775) * (data.band_206))))) - min((1 - ((data.band_178)/((1 - 0.199835775) * (data.band_171) + (0.199835775) * (data.band_206))))) )) * ( ((1 - ((data.band_178)/((1 - 0.199835775) * (data.band_171) + (0.199835775) * (data.band_206))))) - min((1 - ((data.band_178)/((1 - 0.199835775) * (data.band_171) + (0.199835775) * (data.band_206))))) )); Blue:(float)((int)( 255 / ( max((1-((data.band_197) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.29 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) + (data.band_201) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.32 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) + (data.band_203) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.33 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) / (data.band_171) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.12 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) + (data.band_179) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.17 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) + (data.band_185) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.21 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53))))) - min((1-((data.band_197) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.29 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) + (data.band_201) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.32 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) + (data.band_203) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.33 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) / (data.band_171) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.12 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) + (data.band_179) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.17 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) + (data.band_185) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.21 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53))))) )) * ( ((1-((data.band_197) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.29 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) + (data.band_201) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.32 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) + (data.band_203) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.33 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) / (data.band_171) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.12 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) + (data.band_179) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.17 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) + (data.band_185) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.21 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53))))) - min((1-((data.band_197) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.29 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) + (data.band_201) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.32 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) + (data.band_203) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.33 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) / (data.band_171) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.12 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) + (data.band_179) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.17 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53)) + (data.band_185) / (((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.21 + (data.band_233 - ((data.band_125 - data.band_233) / (2.53 - 1.815)) * 2.53))))) )); alpha: (float)((data.band_100 > 0) * 255) }, "tiff", "nodata=65535")'

# must enquote the query or it is not valid request
URI = url + urllib.quote(wcpsQuery)

response = urllib2.urlopen(URI, timeout=30)

content = response.read()

f = open("test_get.png", "w")
f.write(content)
f.close()

